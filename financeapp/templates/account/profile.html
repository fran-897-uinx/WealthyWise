{% extends "layout.html" %} 
{% block content %}
{% load bootstrap5 %} 
{% bootstrap_css %} {% bootstrap_javascript %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
<div class="profile-container">
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="avatar-wrapper">
            <div class="avatar" onclick="changeAvatar()">
                {% if user.profile.avatar %}
                    <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                {% else %}
                    <div class="avatar-placeholder">
                        {{ user.profile.get_initials }}
                    </div>
                {% endif %}
                <div class="avatar-status"></div>
            </div>
        </div>
        <div class="username">{{ user.get_full_name|default:user.username }}</div>
        <div class="user-role">{{ user.profile.get_account_type_display }} Member</div>
    </div>

    <!-- Profile Statistics -->
    <div class="profile-stats">
        <div class="stat-card email" onclick="editEmail()">
            <div class="stat-header">
                <div class="stat-icon">📧</div>
                <div class="stat-title">Email Address</div>
            </div>
            <div class="stat-value">{{ user.email }}</div>
            <div class="stat-subtitle">
                {% if user.profile.email_verified %}Verified{% else %}Not Verified{% endif %} • 
                Last updated {{ user.profile.updated_at|date:"M j, Y" }}
            </div>
        </div>

        <div class="stat-card joined">
            <div class="stat-header">
                <div class="stat-icon">🗓️</div>
                <div class="stat-title">Member Since</div>
            </div>
            <div class="stat-value">{{ user.date_joined|date:"M j, Y" }}</div>
            <div class="stat-subtitle">Active member</div>
        </div>

        <div class="stat-card accounts">
            <div class="stat-header">
                <div class="stat-icon">💼</div>
                <div class="stat-title">Active Accounts</div>
            </div>
            <div class="stat-value">{{ accounts|length }} Accounts</div>
            <div class="stat-subtitle">
                {% with savings_count=accounts|length %}
                    {{ savings_count }} Total Accounts
                {% endwith %}
            </div>
        </div>

        <div class="stat-card amount">
            <div class="stat-header">
                <div class="stat-icon">💰</div>
                <div class="stat-title">Total Balance</div>
            </div>
            <div class="stat-value">₦{{ total_balance|floatformat:2 }}</div>
            <div class="stat-subtitle">Across all accounts</div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h3>Quick Actions</h3>
        <div class="quick-action-grid">
            <a href="{% url 'transaction' %}" class="quick-action">
                <div class="quick-action-icon">💸</div>
                <div class="quick-action-label">Incomes</div>
            </a>
            <a href="{% url 'transaction' %}" class="quick-action">
                <div class="quick-action-icon">🧾</div>
                <div class="quick-action-label">Expenses</div>
            </a>
            <a href="{% url 'export_csv' %}" class="quick-action">
                <div class="quick-action-icon">📋</div>
                <div class="quick-action-label">Statements</div>
            </a>
            <a href="{% url 'faq' %}" class="quick-action" onclick="contactSupport()">
                <div class="quick-action-icon">💬</div>
                <div class="quick-action-label">Support</div>
            </a>
            <a href="{% url 'account_dashboard' %}" class="quick-action">
                <div class="quick-action-icon">💳</div>
                <div class="quick-action-label">Cards</div>
            </a>
            <a href="{% url 'edit_profile' %}" class="quick-action">
                <div class="quick-action-icon">⚙️</div>
                <div class="quick-action-label">Settings</div>
            </a>
        </div>
    </div>

    <!-- Actions Section -->
    <div class="actions-section">
        <h3 class="actions-title">Account Management</h3>
        <div class="action-buttons">
            <a class="profile-btn profile-btn-outline" href="{% url 'edit_profile' %}">
                ✏️ Edit Profile
            </a>

            <a class="profile-btn profile-btn-outline" href="{% url 'transaction' %}">
                📊 View Transactions
            </a>

            <form method="post" action="{% url 'delete_user_account' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="profile-btn profile-btn-danger" onclick="return confirm('Are you sure you want to delete your account? This action cannot be undone.')">
                    🗑️ Delete Account
                </button>
            </form>
        </div>
    </div>
</div>

 <script src="{% static 'js/profile.js' %}"></script>
{% endblock %}